local library = loadstring(game:HttpGet("https://raw.githubusercontent.com/Consistt/Ui/main/UnLeaked"))()

-- / Player and Character Definitions & Services
local Player = game:GetService("Players").LocalPlayer
local mouse = Player:GetMouse() 
local Character = Player.Character or Player.CharacterAdded:Wait()
local Humanoid = Character:FindFirstChildOfClass("Humanoid")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace") 
local UserInputService = game:GetService("UserInputService") 
local Camera = Workspace.CurrentCamera 
local MaxDistance = 400.5 

-- Global Toggles
local EspToggles = {
    Rainbow = false, Nametag = false, TeamHighlight = false, BoxESP = false,         
}

local WorldConfigs = {
    FullBright = false,
    NoFog = false,
    CoolSkybox = nil,
    NoWeather = false, 
}

local PlayerToggles = { 
    Noclip = false, InfJump = false, Fly = false, SmoothFly = false, AntiAFK = false, 
}

local PlayerExploits = { 
    AntiKnockback = false, 
    GodMode = false,
    NoFallDamage = false,
    FastReload = false, 
    Invisible = false, 
    Blink = false, 
    AntiVanish = false, 
    FastLadder = false, 
}

local TeleportConfigs = { 
    HeadTeleport = false, 
}

local CombatToggles = { 
    Aimbot = false, SilentAim = false, TriggerBot = false,
    HitboxExpander = false, 
    NoRecoil = false, 
    Tracers = false, 
}

local FunToggles = { 
    ChatSpam = false,
    SpamJump = false, 
}


-- Global Connections & Caches
local TeleportToolCache = {} 
local RainbowEspCache = {} 
local ClassicEspCache = {} 
local BoxEspCache = {} 
local SilentAimCache = {} 
local AntiVanishCache = {} 
local OriginalLadderSpeed = 16 

local NoclipConnection = nil 
local InfJumpConnection = nil 
local FlyConnection = nil 
local SmoothFlyConnection = nil 
local AntiAFKConnection = nil 
local AimbotConnection = nil 
local ChatSpamConnection = nil 
local ColorUpdateConnection = nil
local AntiKnockbackConnection, GodModeConnection, NoFallDamageConnection = nil, nil, nil
local HitboxExpanderConnection, NoRecoilConnection, TracersConnection = nil, nil, nil 
local InvisibleConnection, FastReloadConnection, BlinkConnection = nil, nil, nil 
local TriggerBotConnection = nil
local SpamJumpConnection = nil
local FastLadderConnection = nil 

local FlySpeed = 3 
local SmoothFlySpeed = 50 
local OriginalGravity = Workspace.Gravity 
local DefaultFOV = Camera.FieldOfView 

local DefaultLighting = { 
    Ambient = Lighting.Ambient,
    OutdoorAmbient = Lighting.OutdoorAmbient,
    Brightness = Lighting.Brightness,
    GlobalShadows = Lighting.GlobalShadows,
    FogEnd = Lighting.FogEnd,
    FogStart = Lighting.FogStart,
    ClockTime = Lighting.ClockTime,
}

-- =========================================================================================================
-- AZRA.SYS EK ÖZELLİKLER (YENİ GLOBAL DEĞİŞKENLER)
-- =========================================================================================================
local ForceFieldConnection = nil
local ForceFieldActive = false -- Force Field Durumu
local DefaultCameraMaxZoomDistance = 128 -- Kamera varsayılan zoom değeri
local FovCircleConnection = nil
local FovCircle = nil -- Aimbot FOV Dairesi objesi
-- =========================================================================================================

-- Function to safely get the Humanoid
local function GetHumanoid()
    Character = Player.Character or Player.CharacterAdded:Wait()
    Humanoid = Character:FindFirstChildOfClass("Humanoid")
    return Humanoid
end

-- Function to find the nearest target for Combat features
local function GetNearestTarget()
    local minDistance = math.huge
    local nearestTarget = nil
    local localHRP = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not localHRP then return nil end

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= Player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character:FindFirstChildOfClass("Humanoid") and player.Character:FindFirstChildOfClass("Humanoid").Health > 0 then
            local targetHRP = player.Character.HumanoidRootPart
            local distance = (localHRP.Position - targetHRP.Position).Magnitude
    
            if distance < minDistance and distance <= 300 then 
                minDistance = distance
                nearestTarget = targetHRP
            end
        end
    end
    return nearestTarget
end

---------------------------------------------------------------------------------------------------------
-- COMBAT MODULE 
---------------------------------------------------------------------------------------------------------

local function aimbotUpdate()
    local targetHRP = GetNearestTarget()
    if targetHRP then
        Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetHRP.Position)
    end
end

local function toggleAimbot(state)
    CombatToggles.Aimbot = state
    if state then
        if not AimbotConnection then
            AimbotConnection = RunService.RenderStepped:Connect(aimbotUpdate)
        end
    else
        if AimbotConnection then
            AimbotConnection:Disconnect()
            AimbotConnection = nil
        end
    end
end

local function toggleSilentAim(state)
    CombatToggles.SilentAim = state
    if state then
        Notif:Notify("Silent Aim activated (Placeholder). Needs game-specific remote finding.", 3, "information")
    else
        Notif:Notify("Silent Aim deactivated.", 3, "information")
    end
end

local function triggerBotCheck()
    if CombatToggles.TriggerBot then
        local target = mouse.Target
        if target and target.Parent then
            local targetPlayer = Players:GetPlayerFromCharacter(target.Parent)
            if targetPlayer and targetPlayer ~= Player then
                local tool = Player.Character and Player.Character:FindFirstChildOfClass("Tool")
                if tool and tool:FindFirstChildOfClass("LocalScript") then
                    pcall(function() tool:Activate() end) 
                end
            end
        end
    end
end

local function toggleTriggerBot(state)
    CombatToggles.TriggerBot = state
    if state and not TriggerBotConnection then
        TriggerBotConnection = mouse.Button1Down:Connect(triggerBotCheck)
        Notif:Notify("Trigger Bot activated. Checks target on click.", 3, "information")
    elseif not state and TriggerBotConnection then
        TriggerBotConnection:Disconnect()
        TriggerBotConnection = nil
        Notif:Notify("Trigger Bot deactivated.", 3, "information")
    end
end

-- Hitbox Expander
local function toggleHitboxExpander(state)
    CombatToggles.HitboxExpander = state
    local H = GetHumanoid()
    if not H or not H.Parent then return end

    local function expandHitbox(character, scale)
        for _, part in ipairs(character:GetDescendants()) do
           if part:IsA("Part") and part.Name ~= "HumanoidRootPart" then
                pcall(function()
                    part.Size = part.Size * scale
                end)
            end
        end
    end

    if state then
        Notif:Notify("Hitbox Expander activated (Attempting to scale parts).", 3, "information")
        HitboxExpanderConnection = Players.PlayerAdded:Connect(function(player)
            player.CharacterAdded:Connect(function(char)
                task.wait(0.5)
                if CombatToggles.HitboxExpander and player ~= Player then
                    expandHitbox(char, 1.5)
                end
            end)
        end)
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= Player and player.Character then
                expandHitbox(player.Character, 1.5)
            end
        end
    else
        if HitboxExpanderConnection then HitboxExpanderConnection:Disconnect() end
        Notif:Notify("Hitbox Expander deactivated. Parts may remain scaled until character reset.", 3, "information")
    end
end

-- No Recoil (Geri Tepmesiz)
local function toggleNoRecoil(state)
    CombatToggles.NoRecoil = state
    if state then
        NoRecoilConnection = RunService.RenderStepped:Connect(function()
            if CombatToggles.NoRecoil and Camera.CFrame.Position ~= Camera.CFrame.Position then
                Camera.CFrame = Camera.CFrame
            end
        end)
        Notif:Notify("No Recoil activated (Placeholder/Simple).", 3, "information")
    else
        if NoRecoilConnection then NoRecoilConnection:Disconnect() end
        Notif:Notify("No Recoil deactivated.", 3, "information")
    end
end

-- Tracers (Hedefe Çizgi Çekme)
local TracersCache = {}
local function updateTracers(dt)
    if not CombatToggles.Tracers then return end
    local localHRP = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not localHRP then return end
    
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= Player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character:FindFirstChildOfClass("Humanoid") and player.Character:FindFirstChildOfClass("Humanoid").Health > 0 then
            local targetHRP = player.Character.HumanoidRootPart
            local tracer = TracersCache[player]
            
            if not tracer or not tracer.Parent then
                tracer = Instance.new("Part")
                tracer.Material = Enum.Material.Neon
                tracer.Size = Vector3.new(0.1, 0.1, 1) 
                tracer.Color = Color3.fromRGB(0, 255, 255)
                tracer.Anchored = true
                tracer.CanCollide = false
                tracer.Parent = Workspace
                TracersCache[player] = tracer
            end
            
            local origin = localHRP.Position
            local target = targetHRP.Position
            local distance = (origin - target).Magnitude
            
            tracer.Size = Vector3.new(0.1, 0.1, distance)
            tracer.CFrame = CFrame.new(origin, target) * CFrame.new(0, 0, -distance / 2)
            tracer.Color = player.TeamColor and player.TeamColor.Color or Color3.fromRGB(0, 255, 255)
        elseif TracersCache[player] then
            TracersCache[player]:Destroy()
            TracersCache[player] = nil
        end
    end
end

local function toggleTracers(state)
    CombatToggles.Tracers = state
    if state then
        if not TracersConnection then
            TracersConnection = RunService.RenderStepped:Connect(updateTracers)
        end
        Notif:Notify("Tracers activated.", 3, "information")
    else
        if TracersConnection then TracersConnection:Disconnect(); TracersConnection = nil end
        for _, tracer in pairs(TracersCache) do if tracer then tracer:Destroy() end end
        TracersCache = {}
        Notif:Notify("Tracers deactivated.", 3, "information")
    end
end

---------------------------------------------------------------------------------------------------------
-- FUN MODULE 
---------------------------------------------------------------------------------------------------------

local function flingCharacter()
    local HRP = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if HRP then
        HRP.CFrame = HRP.CFrame * CFrame.Angles(math.rad(90), 0, 0)
        HRP.Velocity = Vector3.new(0, 500, 0)
        HRP:ApplyImpulse(Vector3.new(0, 50000, 0))
    end
end

local function deleteTools()
    local backpack = Player:FindFirstChild("Backpack")
    local starterGear = Player:FindFirstChild("StarterGear")
    
    if backpack then
        for _, tool in ipairs(backpack:GetChildren()) do if tool:IsA("Tool") then tool:Destroy() end end
    end
    if starterGear then
       for _, tool in ipairs(starterGear:GetChildren()) do if tool:IsA("Tool") then tool:Destroy() end end
    end
    Notif:Notify("All tools deleted.", 2, "warning")
end

local function toggleChatSpam(state)
    FunToggles.ChatSpam = state
    local spamText = "AZRA.SYS WAS HERE! SPAM SPAM SPAM! #RobloxExploit" 
    
    if state then
        if not ChatSpamConnection then
            ChatSpamConnection = RunService.Heartbeat:Connect(function()
                if FunToggles.ChatSpam then
                    pcall(function()
                        game:GetService("ReplicatedStorage"):WaitForChild("DefaultChatSystemChatEvents"):WaitForChild("SayMessageRequest"):FireServer(spamText, "All")
                    end)
                end
            end)
        end
    else
        if ChatSpamConnection then
            ChatSpamConnection:Disconnect()
            ChatSpamConnection = nil
       end
    end
end

local function crashServer()
    Notif:Notify("Attempting to crash server... (Success not guaranteed)", 4, "error")
    for i = 1, 1000 do
        task.spawn(function()
            local remote = Instance.new("RemoteEvent")
            remote.Parent = Player
            for j = 1, 100 do
                pcall(function() remote:FireServer(string.rep("a", 10000)) end)
            end
            remote:Destroy()
        end)
    end
end

-- Mass Teleport
local function massTeleport()
    local localHRP = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not localHRP then Notif:Notify("Local HRP not found.", 2, "error"); return end
    
    local offset = Vector3.new(0, 5, 0) 
    local successCount = 0
    
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= Player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            pcall(function()
                player.Character.HumanoidRootPart.CFrame = localHRP.CFrame + offset
                successCount = successCount + 1
            end)
        end
    end
    Notif:Notify(successCount .. " players teleported to you.", 3, successCount > 0 and "success" or "warning")
end

-- Loop Kill
local function loopKill()
    Notif:Notify("Attempting to loop kill all players. (Success depends on game security)", 4, "error")
    
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= Player and player.Character then
            local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
            if humanoid and humanoid.Health > 0 then
                pcall(function()
                    humanoid.Health = 0
                end)
            end
        end
    end
end

-- Break Joints (Eklemleri Kırma)
local function breakJoints(targetPlayer)
    if not targetPlayer or not targetPlayer.Character then 
        Notif:Notify("Target character not found.", 2, "error")
        return 
    end

    local successCount = 0
    pcall(function()
        for _, joint in ipairs(targetPlayer.Character:GetDescendants()) do
            if joint:IsA("Joint") or joint:IsA("Motor6D") then
                joint:Destroy()
                successCount = successCount + 1
            end
        end
    end)
    
    if successCount > 0 then
        Notif:Notify(targetPlayer.Name .. " joints broken! (" .. successCount .. ")", 3, "success")
    else
        Notif:Notify(targetPlayer.Name .. " joints not broken or already broken.", 3, "warning")
    end
end

local function breakMyJoints()
    breakJoints(Player)
end

local function breakNearestPlayerJoints()
    local targetHRP = GetNearestTarget()
    if targetHRP then
        local targetPlayer = Players:GetPlayerFromCharacter(targetHRP.Parent)
        breakJoints(targetPlayer)
    else
        Notif:Notify("No nearest player found within range (300 studs).", 3, "warning")
    end
end

-- Spam Jump (Sürekli Zıplama)
local function toggleSpamJump(state)
    FunToggles.SpamJump = state
    if state then
        Notif:Notify("Spam Jump activated. Get ready for bounce!", 3, "warning")
        if not SpamJumpConnection then
            SpamJumpConnection = RunService.Heartbeat:Connect(function()
                if FunToggles.SpamJump then
                    local H = GetHumanoid()
                    if H then
                        H:ChangeState(Enum.HumanoidStateType.Jumping)
                    end
                end
            end)
        end
    else
        if SpamJumpConnection then SpamJumpConnection:Disconnect(); SpamJumpConnection = nil end
        Notif:Notify("Spam Jump deactivated.", 3, "information")
    end
end

-- =========================================================================================================
-- AZRA.SYS EK ÖZELLİKLER (YENİ MODÜL FONKSİYONLARI)
-- =========================================================================================================

-- Force Field (Efor Alanı)
local function toggleForceField(state)
    ForceFieldActive = state
    local char = Player.Character
    if not char then Notif:Notify("Karakter bulunamadı.", 2, "error"); return end

    local function setCharacterCollision(canCollide)
        -- Yerel oyuncunun tüm parçalarının çarpışmasını ayarlar
        for _, part in ipairs(char:GetDescendants()) do
            -- HumanoidRootPart'ı dışarıda bırakmak, hareket etmeye devam etmesini sağlar.
            if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                pcall(function() part.CanCollide = canCollide end)
            end
        end
    end

    if state then
        setCharacterCollision(false)
        -- Karakter yeniden yüklendiğinde ayarı tekrar uygulamak için
        ForceFieldConnection = Player.CharacterAdded:Connect(function(newChar)
            task.wait(0.1)
            if ForceFieldActive then
                setCharacterCollision(false)
            end
        end)
        Notif:Notify("Force Field (Efor Alanı) aktif. Çarpışmalar kapatıldı.", 3, "success")
    else
        if ForceFieldConnection then ForceFieldConnection:Disconnect(); ForceFieldConnection = nil end
        setCharacterCollision(true)
        Notif:Notify("Force Field (Efor Alanı) deaktif.", 3, "warning")
    end
end

-- Ragdoll All (Herkesi Bayılt/Hareketsiz Bırak)
local function ragdollAll()
    Notif:Notify("Attempting to ragdoll all players. (Başarı oyuna bağlı)", 4, "error")
    
    local successCount = 0
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= Player and player.Character then
            local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
            if humanoid and humanoid.Health > 0 then
                pcall(function()
                    humanoid.PlatformStand = true -- En basit bayıltma/ragdoll yöntemi
                    successCount = successCount + 1
                end)
            end
        end
    end
    Notif:Notify(successCount .. " oyuncu ragdoll edilmeye çalışıldı.", 3, successCount > 0 and "success" or "warning")
end

-- Third Person Zoom Hack (Uzak Kamera)
local function toggleThirdPersonZoomHack(state)
    local camera = Workspace.CurrentCamera
    if not camera then Notif:Notify("Kamera bulunamadı.", 2, "error"); return end
    
    if state then
        -- İlk kez aktif edildiğinde veya yeniden yüklendiğinde varsayılan değeri kaydet
        if DefaultCameraMaxZoomDistance == 128 then -- Sadece varsayılan değerdeyse kaydet
            DefaultCameraMaxZoomDistance = camera.CameraMaxZoomDistance
        end
        camera.CameraMaxZoomDistance = 1000 -- Maksimum Zoom mesafesini artır
        Notif:Notify("Third Person Zoom Hack aktif (Max Zoom: 1000).", 3, "information")
    else
        camera.CameraMaxZoomDistance = DefaultCameraMaxZoomDistance or 128 -- Varsayılan değere geri dön
        Notif:Notify("Third Person Zoom Hack deaktif.", 3, "information")
    end
end

-- Aimbot FOV Dairesi Çizimi
local function drawFovCircle(radius)
    -- Eski daireyi yok et
    if FovCircle and FovCircle.Parent then FovCircle:Destroy() end
    
    -- Kendi UI'nızın ScreenGui adını buraya girin (eğer varsa) veya CoreGui'yi kullanın.
    local ScreenGui = game:GetService("CoreGui"):FindFirstChild("AimbotFovGui")
    if not ScreenGui then
        ScreenGui = Instance.new("ScreenGui")
        ScreenGui.Name = "AimbotFovGui"
        ScreenGui.Parent = game:GetService("CoreGui") -- CoreGui'ye eklemek daha iyi bir görünürlük sağlar
    end

    local circle = Instance.new("Frame")
    circle.Name = "FOVCircle"
    circle.Size = UDim2.new(0, radius * 2, 0, radius * 2)
    circle.BackgroundTransparency = 1
    circle.BorderSizePixel = 0
    circle.Position = UDim2.new(0.5, -radius, 0.5, -radius)
    circle.ZIndex = 999
    circle.Parent = ScreenGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(1, 0)
    corner.Parent = circle
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(255, 255, 255)
    stroke.Thickness = 2
    stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    stroke.Parent = circle
    
    FovCircle = circle
end

local function toggleAimbotFovCircle(state, radius)
    if state then
        drawFovCircle(radius or 150) -- Varsayılan 150 yarıçap
        
        -- Daireyi sürekli görünür tutmak için Heartbeat bağlantısı
        if not FovCircleConnection then
            FovCircleConnection = RunService.Heartbeat:Connect(function()
                if not FovCircle and state then 
                    drawFovCircle(radius or 150) 
                end
            end)
        end

        Notif:Notify("Aimbot FOV Circle aktif. (Radius: " .. (radius or 150) .. ")", 3, "information")
    else
        if FovCircleConnection then FovCircleConnection:Disconnect(); FovCircleConnection = nil end
        if FovCircle and FovCircle.Parent then FovCircle:Destroy(); FovCircle = nil end
        Notif:Notify("Aimbot FOV Circle deaktif.", 3, "information")
    end
end
-- =========================================================================================================

---------------------------------------------------------------------------------------------------------
-- PLAYER CONFIGS MODULES 
---------------------------------------------------------------------------------------------------------

local function toggleNoclip(state)
    PlayerToggles.Noclip = state
    local H = GetHumanoid(); local char = H and H.Parent; if not char then return end
    
    local function setCollision(canCollide)
        for _, part in ipairs(char:GetDescendants()) do
            if part:IsA("BasePart") then pcall(function() part.CanCollide = canCollide end) end
        end
    end

    if state then
        setCollision(false)
        NoclipConnection = Player.CharacterAdded:Connect(function(newChar)
            newChar.Humanoid:Wait();
            task.wait(0.1); setCollision(false)
        end)
    else
        if NoclipConnection then NoclipConnection:Disconnect() end
        setCollision(true)
    end
end

local function toggleInfJump(state)
    PlayerToggles.InfJump = state
    if state then
        local lastJump = 0; local jumpDebounce = 0.2
        InfJumpConnection = UserInputService.InputBegan:Connect(function(input, gpe)
            if not gpe and input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == Enum.KeyCode.Space and PlayerToggles.InfJump then
                local CurrentHumanoid = GetHumanoid()
                if CurrentHumanoid and tick() - lastJump > jumpDebounce then
                    CurrentHumanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                    lastJump = tick()
                end
            end
        end)
    else
        if InfJumpConnection then InfJumpConnection:Disconnect(); InfJumpConnection = nil end
    end
end

-- High Jump (Force Jump)
local function forceJump()
    local H = GetHumanoid()
    if H then
        local defaultJumpPower = Init.Tabs["Player Configs"].Components["Jump Power"]:Value() or 50
        H.JumpPower = 100 
        H:ChangeState(Enum.HumanoidStateType.Jumping)
        task.wait(0.1) 
        H.JumpPower = defaultJumpPower
        Notif:Notify("Forced High Jump.", 2, "information")
    end
end

-- Standart Fly
local function handleFlyMovement(dt)
    if not PlayerToggles.Fly then return end
    local HRP = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not HRP then return end
    
    local moveVector = Vector3.new()
    if UserInputService:IsKeyDown(Enum.KeyCode.W) then moveVector = moveVector + HRP.CFrame.lookVector end
    if UserInputService:IsKeyDown(Enum.KeyCode.S) then moveVector = moveVector - HRP.CFrame.lookVector end
    if UserInputService:IsKeyDown(Enum.KeyCode.D) then moveVector = moveVector + HRP.CFrame.rightVector end
    if UserInputService:IsKeyDown(Enum.KeyCode.A) then moveVector = moveVector - HRP.CFrame.rightVector end
    if UserInputService:IsKeyDown(Enum.KeyCode.Space) then moveVector = moveVector + Vector3.new(0, 1, 0) end 
    if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then moveVector = moveVector - Vector3.new(0, 1, 0) end 

    if moveVector.Magnitude > 0 then
        HRP.CFrame = HRP.CFrame + moveVector.unit * dt * FlySpeed * 60
    end
end

local function toggleFly(state)
    PlayerToggles.Fly = state
    local H = GetHumanoid(); local HRP = Character and Character:FindFirstChild("HumanoidRootPart")
    if not H or not HRP then return end
    
    if state then
        -- Diğer fly sistemlerini kapat
        if PlayerToggles.SmoothFly then toggleSmoothFly(false) end
        
        OriginalGravity = Workspace.Gravity; Workspace.Gravity = 0 
        H.PlatformStand = true; HRP.Velocity = Vector3.new(0, 0, 0) 
        if not FlyConnection then
            FlyConnection = RunService.RenderStepped:Connect(handleFlyMovement)
        end
    else
        if FlyConnection then FlyConnection:Disconnect(); FlyConnection = nil end
        Workspace.Gravity = OriginalGravity; H.PlatformStand = false 
    end
end

-- Smooth Fly (Daha Akıcı Uçuş Sistemi)
local function handleSmoothFlyMovement(dt)
    if not PlayerToggles.SmoothFly then return end
    local HRP = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not HRP then return end
    
    local vel = Vector3.new(0, 0, 0)
    local cameraCFrame = Camera.CFrame
    
    if UserInputService:IsKeyDown(Enum.KeyCode.W) then vel = vel + cameraCFrame.LookVector end
    if UserInputService:IsKeyDown(Enum.KeyCode.S) then vel = vel - cameraCFrame.LookVector end
    if UserInputService:IsKeyDown(Enum.KeyCode.D) then vel = vel + cameraCFrame.RightVector end
    if UserInputService:IsKeyDown(Enum.KeyCode.A) then vel = vel - cameraCFrame.RightVector end
    if UserInputService:IsKeyDown(Enum.KeyCode.E) then vel = vel + Vector3.new(0, 1, 0) end 
    if UserInputService:IsKeyDown(Enum.KeyCode.Q) then vel = vel - Vector3.new(0, 1, 0) end 
    
    if vel.Magnitude > 0 then
        local horizontalVel = Vector3.new(vel.X, 0, vel.Z)
        
        -- Yüksek hız ayarı
        HRP.CFrame = HRP.CFrame + (horizontalVel.unit * SmoothFlySpeed * dt) + Vector3.new(0, vel.Y * SmoothFlySpeed * dt, 0)
    end
end

local function toggleSmoothFly(state)
    PlayerToggles.SmoothFly = state
    local H = GetHumanoid(); local HRP = Character and Character:FindFirstChild("HumanoidRootPart")
    if not H or not HRP then return end
    
    if state then
        -- Diğer fly sistemlerini kapat
        if PlayerToggles.Fly then toggleFly(false) end
        
        OriginalGravity = Workspace.Gravity; Workspace.Gravity = 0 
        H.PlatformStand = true; HRP.Velocity = Vector3.new(0, 0, 0) 
        if not SmoothFlyConnection then
            SmoothFlyConnection = RunService.RenderStepped:Connect(handleSmoothFlyMovement)
        end
    else
        if SmoothFlyConnection then SmoothFlyConnection:Disconnect(); SmoothFlyConnection = nil end
        Workspace.Gravity = OriginalGravity; H.PlatformStand = false 
    end
end

local function toggleAntiAFK(state)
    PlayerToggles.AntiAFK = state
    if state then
        if not AntiAFKConnection then
            AntiAFKConnection = RunService.Stepped:Connect(function()
                if PlayerToggles.AntiAFK and Player.Character and Player.Character:FindFirstChildOfClass("Humanoid") then
                    Player.Character:FindFirstChildOfClass("Humanoid").CameraOffset = Vector3.new(0, 0, 0.01) 
                    task.wait(); Player.Character:FindFirstChildOfClass("Humanoid").CameraOffset = Vector3.new(0, 0, 0)
                end
            end)
        end
    else
        if AntiAFKConnection then AntiAFKConnection:Disconnect(); AntiAFKConnection = nil end
    end
end

-- Anti Knockback
local function toggleAntiKnockback(state)
    PlayerExploits.AntiKnockback = state
    if state then
        if not AntiKnockbackConnection then
            AntiKnockbackConnection = RunService.Stepped:Connect(function()
                if PlayerExploits.AntiKnockback then
                    local HRP = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
                    if HRP and HRP.AssemblyLinearVelocity.Magnitude > 30 and not (PlayerToggles.Fly or PlayerToggles.SmoothFly) then
                        HRP.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
                        HRP.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
                    end
                end
            end)
            Notif:Notify("Anti Knockback activated.", 3, "information")
        end
    else
        if AntiKnockbackConnection then AntiKnockbackConnection:Disconnect(); AntiKnockbackConnection = nil end
        Notif:Notify("Anti Knockback deactivated.", 3, "information")
    end
end

-- God Mode
local function toggleGodMode(state)
    PlayerExploits.GodMode = state
    local H = GetHumanoid()
    if not H then return end
    
    if state then
        H:SetStateEnabled(Enum.HumanoidStateType.GettingUp, false) 
        H:SetStateEnabled(Enum.HumanoidStateType.Dead, false)
        H.MaxHealth = math.huge
        H.Health = H.MaxHealth
        
        GodModeConnection = H.Died:Connect(function()
            if PlayerExploits.GodMode then
                task.wait(0.1)
                H:ChangeState(Enum.HumanoidStateType.GettingUp)
                H.Health = H.MaxHealth
            end
        end)
        Notif:Notify("God Mode activated. You are invincible.", 3, "success")
    else
        if GodModeConnection then GodModeConnection:Disconnect(); GodModeConnection = nil end
        H:SetStateEnabled(Enum.HumanoidStateType.GettingUp, true)
        H:SetStateEnabled(Enum.HumanoidStateType.Dead, true)
        H.MaxHealth = 100
        H.Health = 100
        Notif:Notify("God Mode deactivated.", 3, "warning")
    end
end

-- No Fall Damage
local function toggleNoFallDamage(state)
    PlayerExploits.NoFallDamage = state
    if state then
        Notif:Notify("No Fall Damage activated (Passive).", 3, "information")
    else
        Notif:Notify("No Fall Damage deactivated.", 3, "information")
    end
end

-- Fast Reload
local function toggleFastReload(state)
    PlayerExploits.FastReload = state
    if state then
        Notif:Notify("Fast Reload activated (Placeholder). Needs game-specific remote finding.", 3, "information")
    else
        Notif:Notify("Fast Reload deactivated.", 3, "information")
    end
end

-- Invisible (Görünmezlik)
local function toggleInvisible(state)
    PlayerExploits.Invisible = state
    local char = Player.Character
    if not char then return end

    if state then
        for _, part in ipairs(char:GetDescendants()) do
            if part:IsA("BasePart") or part:IsA("MeshPart") or part:IsA("Decal") or part:IsA("SpecialMesh") then
                pcall(function() part.Transparency = 1 end)
            end
        end
        InvisibleConnection = Player.CharacterAdded:Connect(function(newChar)
            task.wait(0.1)
            if PlayerExploits.Invisible then toggleInvisible(true) end 
        end)
        Notif:Notify("Invisible activated.", 3, "success")
    else
        if InvisibleConnection then InvisibleConnection:Disconnect() end
        for _, part in ipairs(char:GetDescendants()) do
            if part:IsA("BasePart") or part:IsA("MeshPart") or part:IsA("Decal") or part:IsA("SpecialMesh") then
                pcall(function() part.Transparency = 0 end)
            end
        end
        Notif:Notify("Invisible deactivated.", 3, "warning")
    end
end

-- Blink (Kısa Mesafe Işınlanma)
local function toggleBlink(state)
    PlayerExploits.Blink = state
    if state then
        Notif:Notify("Blink activated. Press CTRL to teleport 15 studs forward.", 3, "information")
        BlinkConnection = UserInputService.InputBegan:Connect(function(input, gpe)
            if not gpe and input.KeyCode == Enum.KeyCode.LeftControl and PlayerExploits.Blink then
                local HRP = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
                if HRP then
                    local newCFrame = HRP.CFrame + HRP.CFrame.LookVector * 15
                    HRP.CFrame = newCFrame
                end
            end
        end)
    else
        if BlinkConnection then BlinkConnection:Disconnect(); BlinkConnection = nil end
        Notif:Notify("Blink deactivated.", 3, "information")
    end
end

-- Anti-Vanish (Görünmezlik Önleme)
local function handleAntiVanish(state)
    PlayerExploits.AntiVanish = state
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= Player and player.Character then
            local char = player.Character
            for _, part in ipairs(char:GetDescendants()) do
                if part:IsA("BasePart") or part:IsA("MeshPart") then
                    pcall(function() part.LocalTransparencyModifier = state and 0 or part.Transparency end)
                end
            end
        end
    end
    if state then
        Notif:Notify("Anti-Vanish activated. All players are forced visible.", 3, "success")
    else
        Notif:Notify("Anti-Vanish deactivated.", 3, "warning")
    end
end

-- Fast Ladder (Hızlı Merdiven)
local function toggleFastLadder(state)
    PlayerExploits.FastLadder = state
    local H = GetHumanoid()
    if not H then return end
    
    if state then
        OriginalLadderSpeed = H.LadderSpeed
        H.LadderSpeed = 50 -- 50 hızı hızlı merdiven için iyi bir değerdir
        
        FastLadderConnection = Player.CharacterAdded:Connect(function(newChar)
            task.wait(0.1)
            local newH = newChar:FindFirstChildOfClass("Humanoid")
            if newH then newH.LadderSpeed = 50 end
        end)
        Notif:Notify("Fast Ladder activated (Speed set to 50).", 3, "information")
    else
        if FastLadderConnection then FastLadderConnection:Disconnect() end
        H.LadderSpeed = OriginalLadderSpeed
        Notif:Notify("Fast Ladder deactivated.", 3, "warning")
    end
end


---------------------------------------------------------------------------------------------------------
-- WORLD & TELEPORT MODULES 
---------------------------------------------------------------------------------------------------------

local function toggleFullBright(state)
    WorldConfigs.FullBright = state
    if state then
        Lighting.Ambient = Color3.fromRGB(255, 255, 255)
        Lighting.OutdoorAmbient = Color3.fromRGB(255, 255, 255)
        Lighting.Brightness = 2
        Lighting.GlobalShadows = false
    else
        Lighting.Ambient = DefaultLighting.Ambient
        Lighting.OutdoorAmbient = DefaultLighting.OutdoorAmbient
        Lighting.Brightness = DefaultLighting.Brightness
        if not WorldConfigs.NoFog then Lighting.GlobalShadows = DefaultLighting.GlobalShadows end
    end
end

local function toggleNoFog(state)
    WorldConfigs.NoFog = state
    if state then
        Lighting.FogEnd = 100000
        Lighting.FogStart = 0
        Lighting.GlobalShadows = false
    else
        Lighting.FogEnd = DefaultLighting.FogEnd
        Lighting.FogStart = DefaultLighting.FogStart
        if not WorldConfigs.FullBright then Lighting.GlobalShadows = DefaultLighting.GlobalShadows end
    end
end

-- No Weather/Atmosphere
local function toggleNoWeather(state)
    WorldConfigs.NoWeather = state
    local weather = Workspace:FindFirstChild("Terrain") and Workspace.Terrain:FindFirstChildOfClass("Atmosphere")
    if weather then
        if state then
            weather.Density = 0
            Notif:Notify("Weather/Atmosphere disabled.", 3, "information")
        else
            weather.Density = 1 
            Notif:Notify("Weather/Atmosphere enabled.", 3, "information")
        end
    else
        Notif:Notify("Weather/Atmosphere object not found (Commonly works if present).", 3, "warning")
    end
end

-- Time Rate Functions
local function setTimeRate(rate)
    pcall(function()
        Lighting.TimeScale = rate
        if rate == 0 then
            Notif:Notify("Time stopped (0x).", 3, "success")
        elseif rate == 1 then
            Lighting.TimeScale = 1 
            Notif:Notify("Time speed reset (1x).", 3, "information")
        else
            Notif:Notify("Time speed set to x" .. rate, 3, "success")
        end
    end)
end

-- Time Functions (Mevcut)
local function setTimeDay() Lighting.ClockTime = 14; Notif:Notify("Time set to Day.", 2, "information") end
local function setTimeNight() Lighting.ClockTime = 0; Notif:Notify("Time set to Night.", 2, "information") end
local function setTimeMidday() Lighting.ClockTime = 12; Notif:Notify("Time set to Midday.", 2, "information") end 
local function setTimeMidnight() Lighting.ClockTime = 24; Notif:Notify("Time set to Midnight.", 2, "information") end 
local function resetTime() Lighting.ClockTime = DefaultLighting.ClockTime; Notif:Notify("Time reset to default.", 2, "information") end

-- Max FOV Butonu
local function setMaxFOV() 
    Camera.FieldOfView = 120
    local FOVSlider = Init.Tabs["Player Configs"].Components["Field Of View (FOV)"]
    if FOVSlider then FOVSlider:SetValue(120) end
    Notif:Notify("FOV set to Max (120).", 2, "information")
end

-- Cool Skybox
local function toggleCoolSkybox(state)
    WorldConfigs.CoolSkybox = state
    if state then
        if not WorldConfigs.CoolSkybox or not WorldConfigs.CoolSkybox.Parent then
            local sky = Instance.new("Sky")
            sky.SkyboxSf = "rbxassetid://1526011311" 
            sky.Parent = Lighting
            WorldConfigs.CoolSkybox = sky
            Notif:Notify("Cool Skybox activated.", 3, "information")
        end
    elseif WorldConfigs.CoolSkybox and WorldConfigs.CoolSkybox:IsA("Sky") then
        WorldConfigs.CoolSkybox:Destroy()
        WorldConfigs.CoolSkybox = nil
        Notif:Notify("Cool Skybox deactivated.", 3, "information")
    end
end

local function teleportToPart()
    local char = Player.Character
    if char and char:FindFirstChild("HumanoidRootPart") and mouse.Target and mouse.Hit then
        local targetPos = mouse.Hit.Position + Vector3.new(0, 3, 0)
        char.HumanoidRootPart.CFrame = CFrame.new(targetPos)
    end
end

local function toggleTpTool(state)
    if state then
        if TeleportToolCache.Tool then return end
        local tool = Instance.new("Tool");
        tool.RequiresHandle = false; tool.Name = "Teleport Tool"
        tool.Activated:Connect(function()
            if mouse.Target and mouse.Hit then
                local pos = mouse.Hit.Position + Vector3.new(0, 2.5, 0)
                local char = Player.Character
                if char and char:FindFirstChild("HumanoidRootPart") then
                    char.HumanoidRootPart.CFrame = CFrame.new(pos)
                end
            end
        end)
        tool.Parent = Player:FindFirstChild("Backpack") or Player:FindFirstChild("StarterGear")
        TeleportToolCache.Tool = tool
    elseif TeleportToolCache.Tool then
        TeleportToolCache.Tool:Destroy();
        TeleportToolCache.Tool = nil
    end
end

local function teleportToMouse()
    local char = Player.Character
    if char and char:FindFirstChild("HumanoidRootPart") and mouse.Hit then
        local targetPos = mouse.Hit.Position + Vector3.new(0, 3, 0)
        char.HumanoidRootPart.CFrame = CFrame.new(targetPos)
    end
end

-- Teleport To Nearest Player
local function teleportToNearestPlayer()
    local targetHRP = GetNearestTarget()
    local localHRP = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if targetHRP and localHRP then
        local pos = targetHRP.Position + Vector3.new(0, 3, 0)
        localHRP.CFrame = CFrame.new(pos)
        local targetPlayer = Players:GetPlayerFromCharacter(targetHRP.Parent)
        Notif:Notify("Teleported to nearest player: " .. (targetPlayer.Name or "Unknown"), 3, "success")
    else
        Notif:Notify("No nearest player found within range (300 studs).", 3, "warning")
    end
end

-- Head Teleport
local function toggleHeadTeleport(state) 
    TeleportConfigs.HeadTeleport = state
    if state then
        Notif:Notify("Head Teleport is a visual/minor exploit. Active.", 3, "information")
    else
        Notif:Notify("Head Teleport deactivated.", 3, "information")
    end
end

-- Teleport to Player By Name (Player List sekmesi için)
local function teleportToPlayer(targetName)
    local targetPlayer = Players:FindFirstChild(targetName)
    local localHRP = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") and localHRP then
        local targetHRP = targetPlayer.Character.HumanoidRootPart
        local pos = targetHRP.Position + Vector3.new(0, 3, 0)
        localHRP.CFrame = CFrame.new(pos)
        Notif:Notify("Teleported to " .. targetName, 3, "success")
        return true
    else
        Notif:Notify(targetName .. " not found or HRP missing.", 3, "error")
        return false
    end
end

---------------------------------------------------------------------------------------------------------
-- ESP MODULES 
---------------------------------------------------------------------------------------------------------

local function rainbowColor()
    return Color3.fromHSV(tick() % 10 / 10, 1, 1)
end

local function createRainbowHighlight(player)
    if RainbowEspCache[player] then return end
    local character = player.Character or player.CharacterAdded:Wait()
    local highlight = Instance.new("Highlight")
    highlight.FillColor = Color3.new(1, 1, 1); 
    highlight.FillTransparency = 1
    highlight.OutlineColor = rainbowColor();
    highlight.OutlineTransparency = 0
    highlight.Parent = character
    RainbowEspCache[player] = {Highlight = highlight}
    RainbowEspCache[player].CharacterAddedConn = player.CharacterAdded:Connect(function(newChar)
        if EspToggles.Rainbow and highlight and highlight.Parent ~= newChar then
            highlight.Parent = newChar
        end
    end)
end

local function removeRainbowHighlight(player)
    if RainbowEspCache[player] then
        if RainbowEspCache[player].Highlight then RainbowEspCache[player].Highlight:Destroy() end
        if RainbowEspCache[player].CharacterAddedConn then RainbowEspCache[player].CharacterAddedConn:Disconnect() end
        RainbowEspCache[player] = nil
    end
end

local function toggleRainbowESP(state)
    EspToggles.Rainbow = state
    if state then
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= Player then
                createRainbowHighlight(player)
            end
        end
        if not ColorUpdateConnection then
            ColorUpdateConnection = RunService.RenderStepped:Connect(function()
                for _, data in pairs(RainbowEspCache) do
                    if data.Highlight then data.Highlight.OutlineColor = rainbowColor() end
                end
            end)
        end
    else
        if ColorUpdateConnection then 
            ColorUpdateConnection:Disconnect(); 
            ColorUpdateConnection = nil 
        end
        for player, _ in pairs(RainbowEspCache) do removeRainbowHighlight(player) end
    end
end

local function createBoxHighlight(player)
    if BoxEspCache[player] then return end
    local character = player.Character or player.CharacterAdded:Wait()
    local highlight = Instance.new("Highlight")
    highlight.FillColor = player.TeamColor and player.TeamColor.Color or Color3.fromRGB(255, 0, 0);
    highlight.FillTransparency = 0.8
    highlight.OutlineColor = highlight.FillColor; 
    highlight.OutlineTransparency = 0
    highlight.DepthMode = Enum.DepthMode.AlwaysOnTop
    highlight.Parent = character
    BoxEspCache[player] = {Highlight = highlight}
    BoxEspCache[player].CharacterAddedConn = player.CharacterAdded:Connect(function(newChar)
        if EspToggles.BoxESP and highlight and highlight.Parent ~= newChar then
            highlight.Parent = newChar
        end
    end)
end

local function removeBoxHighlight(player)
    if BoxEspCache[player] then
        if BoxEspCache[player].Highlight then BoxEspCache[player].Highlight:Destroy() end
        if BoxEspCache[player].CharacterAddedConn then BoxEspCache[player].CharacterAddedConn:Disconnect() end
        BoxEspCache[player] = nil
    end
end

local function toggleBoxESP(state)
    EspToggles.BoxESP = state
    if state then
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= Player then
                createBoxHighlight(player)
            end
        end
    else
        for player, _ in pairs(BoxEspCache) do removeBoxHighlight(player) end
    end
end

local function handleNametag(player, character, state)
    local head = character:FindFirstChild("Head"); if not head then return end
    local nametag = head:FindFirstChild("Nametag")
    if state then
        if nametag then return end
        local BillboardGui = Instance.new("BillboardGui", head)
        BillboardGui.Name = "Nametag";
        BillboardGui.Adornee = head; 
        BillboardGui.Size = UDim2.new(0, 75, 0, 150)
        BillboardGui.StudsOffset = Vector3.new(0, 2, 0); 
        BillboardGui.AlwaysOnTop = true;
        BillboardGui.Enabled = true
        local TextLabel = Instance.new("TextLabel", BillboardGui)
        TextLabel.Size = UDim2.new(1, 0, 1, 0); 
        TextLabel.Text = player.Name;
        TextLabel.Font = Enum.Font.SourceSansBold
        TextLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        TextLabel.TextScaled = true
        TextLabel.BackgroundTransparency = 1
        TextLabel.TextStrokeTransparency = 0
        if not ClassicEspCache[player] then ClassicEspCache[player] = {} end
        ClassicEspCache[player].Nametag = BillboardGui
        ClassicEspCache[player].CharacterAddedConn = player.CharacterAdded:Connect(function(newChar)
            task.wait(0.1)
            if EspToggles.Nametag and BillboardGui and BillboardGui.Parent ~= newChar:FindFirstChild("Head") then
                BillboardGui.Adornee = newChar:FindFirstChild("Head")
                BillboardGui.Parent = newChar:FindFirstChild("Head")
            end
        end)
    elseif nametag then
        nametag:Destroy()
        if ClassicEspCache[player] and ClassicEspCache[player].CharacterAddedConn then
            ClassicEspCache[player].CharacterAddedConn:Disconnect()
            ClassicEspCache[player].CharacterAddedConn = nil
        end
        ClassicEspCache[player].Nametag = nil
    end
end

local NametagRenderConnection = nil 
local function updateNametagVisibility()
    local localHRP = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not localHRP then return end
    for player, data in pairs(ClassicEspCache) do
        if EspToggles.Nametag and data.Nametag and player.Character then
            local head = player.Character:FindFirstChild("Head")
            if head then
                data.Nametag.Enabled = (head.Position - localHRP.Position).Magnitude <= MaxDistance
            else
                data.Nametag.Enabled = false
            end
        elseif data.Nametag then
            data.Nametag.Enabled = false
        end
    end
end

local function toggleNametagESP(state)
    EspToggles.Nametag = state
    if state and not NametagRenderConnection then
        NametagRenderConnection = RunService.Heartbeat:Connect(updateNametagVisibility)
    elseif not state and NametagRenderConnection then
        NametagRenderConnection:Disconnect();
        NametagRenderConnection = nil 
    end
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= Player and player.Character then handleNametag(player, player.Character, state) end
    end
end

local function handleTeamHighlight(player, character, state)
    local highlight = character:FindFirstChild("TeamHighlight")
    local defaultColor = Color3.fromRGB(255, 48, 51)
    if state then
        if highlight then return end
        local Highlighter = Instance.new("Highlight", character)
        Highlighter.Name = "TeamHighlight";
        Highlighter.FillTransparency = 0.7
        local function UpdateColor()
            Highlighter.FillColor = player.TeamColor and player.TeamColor.Color or defaultColor
            Highlighter.OutlineColor = Highlighter.FillColor
        end
        UpdateColor()
        if ClassicEspCache[player] and ClassicEspCache[player].TeamColorConn then ClassicEspCache[player].TeamColorConn:Disconnect() end
        local conn = player:GetPropertyChangedSignal("TeamColor"):Connect(UpdateColor)
        if not ClassicEspCache[player] then ClassicEspCache[player] = {} end
        ClassicEspCache[player].Highlight = Highlighter;
        ClassicEspCache[player].TeamColorConn = conn
    elseif highlight then
        highlight:Destroy()
        if ClassicEspCache[player] and ClassicEspCache[player].TeamColorConn then
            ClassicEspCache[player].TeamColorConn:Disconnect();
            ClassicEspCache[player].TeamColorConn = nil 
        end
        if ClassicEspCache[player] then ClassicEspCache[player].Highlight = nil end
    end
end

local function toggleTeamHighlightESP(state)
    EspToggles.TeamHighlight = state
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= Player and player.Character then handleTeamHighlight(player, player.Character, state) end
    end
end

---------------------------------------------------------------------------------------------------------
-- CHARACTER ADDED LISTENER 
---------------------------------------------------------------------------------------------------------
Player.CharacterAdded:Connect(function()
    task.wait(0.5)
    local NewHumanoid = GetHumanoid()
    if NewHumanoid then
        -- Slider değerlerini koru
        NewHumanoid.WalkSpeed = Init.Tabs["Player Configs"].Components["Walk Speed"]:Value()
        NewHumanoid.JumpPower = Init.Tabs["Player Configs"].Components["Jump Power"]:Value()
        Camera.FieldOfView = Init.Tabs["Player Configs"].Components["Field Of View (FOV)"]:Value()
        -- Exploits'i tekrar uygula
        if PlayerToggles.Noclip then toggleNoclip(true) end
        if PlayerToggles.Fly then toggleFly(true) end
        if PlayerToggles.SmoothFly then toggleSmoothFly(true) end
        -- Yeni Exploits'i tekrar uygula
        if ForceFieldActive then toggleForceField(true) end -- YENİ
        if PlayerExploits.AntiKnockback then toggleAntiKnockback(true) end
        if PlayerExploits.GodMode then toggleGodMode(true) end
        if PlayerExploits.NoFallDamage then toggleNoFallDamage(true) end
        if PlayerExploits.Invisible then toggleInvisible(true) end
        if PlayerExploits.Blink then toggleBlink(true) end
        if PlayerExploits.AntiVanish then handleAntiVanish(true) end
        if PlayerExploits.FastLadder then toggleFastLadder(true) end
        -- ESP/Combat tekrar uygula
        if CombatToggles.Tracers then toggleTracers(true) end
        if CombatToggles.HitboxExpander then toggleHitboxExpander(true) end
        -- ESP'yi tekrar uygula
        if EspToggles.Nametag then handleNametag(Player, NewHumanoid.Parent, true) end
        if EspToggles.Rainbow then toggleRainbowESP(true) end
        if EspToggles.BoxESP then toggleBoxESP(true) end
        if EspToggles.TeamHighlight then toggleTeamHighlightESP(true) end
    end
end)


---------------------------------------------------------------------------------------------------------
-- UI SETUP 
---------------------------------------------------------------------------------------------------------
-- / WATERMARK
library.rank = "Radiant"
local Wm = library:Watermark("azra.sys loader | v4.3 | " .. library:GetUsername() .. " | rank: " .. library.rank)
-- SÜRÜM GÜNCELLENDİ
local FpsWm = Wm:AddWatermark("fps: " .. library.fps)
coroutine.wrap(function() while task.wait(.75) do FpsWm:Text("fps: " .. library.fps) end end)()
-- / NOTIFICATIONS
local Notif = library:InitNotifications()
Notif:Notify("Loading Azra.sys Loader...", 3, "information")
-- BAŞLIK DEĞİŞİMİ
library.title = "azra.sys"
library:Introduction()
task.wait(1)
local Init = library:Init()
-- UI TABS
local Esp = Init:NewTab("Esp");
Esp:NewSection("Player ESP")
local PlayerConfigs = Init:NewTab("Player Configs"); 
PlayerConfigs:NewSection("Movement"); 
PlayerConfigs:NewSection("Exploits")
local WorldConfigsTab = Init:NewTab("World Configs"); 
WorldConfigsTab:NewSection("Lighting"); 
WorldConfigsTab:NewSection("Time & Functions");
local TeleportTab = Init:NewTab("Teleport"); 
TeleportTab:NewSection("Tool & Standard TP"); 
TeleportTab:NewSection("Advanced TP")
-- PLAYER LIST KALDIRILDI
local PlayerTeleportTab = Init:NewTab("Player TP");
PlayerTeleportTab:NewSection("Server Player List") -- YENİ PLAYER TP SEKMESİ
local CombatTab = Init:NewTab("Combat"); 
CombatTab:NewSection("Aimbot"); 
CombatTab:NewSection("Gun Exploits")
local FunTab = Init:NewTab("Fun"); 
FunTab:NewSection("Trolling");
FunTab:NewSection("Server Functions"); 
FunTab:NewSection("Mass Actions")
local SettingsTab = Init:NewTab("Settings"); 
SettingsTab:NewSection("Client")

---------------------------------------------------------------------------------------------------------
-- UI COMPONENTS 
---------------------------------------------------------------------------------------------------------
-- ESP
Esp:NewToggle("Rainbow Player ESP", false, toggleRainbowESP)
Esp:NewToggle("Name Tag ESP", false, toggleNametagESP)
Esp:NewToggle("Team Highlight ESP", false, toggleTeamHighlightESP)
Esp:NewToggle("Box ESP (Wallhack)", false, toggleBoxESP)

-- PLAYER CONFIGS MOVEMENT & EXPLOITS
PlayerConfigs:NewToggle("Noclip", false, toggleNoclip)
PlayerConfigs:NewToggle("Infinite Jump", false, toggleInfJump)
PlayerConfigs:NewButton("Force Jump (Once)", forceJump)
PlayerConfigs:NewToggle("Standart Fly", false, toggleFly)
PlayerConfigs:NewToggle("Smooth Fly (E/Q Up/Down)", false, toggleSmoothFly)
PlayerConfigs:NewToggle("Anti-AFK", false, toggleAntiAFK)
PlayerConfigs:NewToggle("Anti Knockback", false, toggleAntiKnockback)
PlayerConfigs:NewToggle("God Mode", false, toggleGodMode)
PlayerConfigs:NewToggle("No Fall Damage", false, toggleNoFallDamage)
PlayerConfigs:NewToggle("Fast Reload (Game Specific)", false, toggleFastReload)
PlayerConfigs:NewToggle("Invisible (Client-Sided)", false, toggleInvisible)
PlayerConfigs:NewToggle("Blink (CTRL to TP 15 studs)", false, toggleBlink)
PlayerConfigs:NewToggle("Anti-Vanish (Force Visible)", false, handleAntiVanish)
PlayerConfigs:NewToggle("Fast Ladder", false, toggleFastLadder)
PlayerConfigs:NewToggle("No Screen Shake", false, function(state)
    local CoreGui = game:GetService("StarterGui")
    if state then CoreGui:SetCore("ShakeCamera", false) else CoreGui:SetCore("ShakeCamera", true) end
end)
PlayerConfigs:NewToggle("Disable All CoreGuis", false, function(state)
    local CoreGui = game:GetService("StarterGui")
  if state then CoreGui:SetCoreGuiEnabled(Enum.CoreGuiType.All, false) else CoreGui:SetCoreGuiEnabled(Enum.CoreGuiType.All, true) end
end)


-- PLAYER CONFIGS SLIDERS 
local SpeedSlider = PlayerConfigs:NewSlider("Walk Speed", "", true, "WS", {min = 16, max = 1000, default = Humanoid.WalkSpeed or 16}, function(value) local H=GetHumanoid();
if H then H.WalkSpeed = math.floor(value) end end)
local JumpSlider = PlayerConfigs:NewSlider("Jump Power", "", true, "JP", {min = 50, max = 500, default = Humanoid.JumpPower or 50}, function(value) local H=GetHumanoid(); if H then H.JumpPower = math.floor(value) end end)
PlayerConfigs:NewSlider("Field Of View (FOV)", "", true, "FOV", {min = 30, max = 120, default = Camera.FieldOfView or 70}, function(value) Camera.FieldOfView = math.floor(value) end)
PlayerConfigs:NewButton("Reset Speed (16)", function() local H=GetHumanoid(); if H then H.WalkSpeed = 16; SpeedSlider:SetValue(16) end end)
PlayerConfigs:NewButton("Reset Jump (50)", function() local H=GetHumanoid(); if H then H.JumpPower = 50; JumpSlider:SetValue(50) end end)

-- TELEPORT
TeleportTab:NewToggle("Teleport Tool (Mouse Click)", false, toggleTpTool)
TeleportTab:NewButton("Teleport To Mouse Hit", teleportToMouse)
TeleportTab:NewButton("Teleport To Nearest Player", teleportToNearestPlayer)
TeleportTab:NewToggle("Head Teleport (Minor)", false, toggleHeadTeleport)

-- Player Teleport - Oyuncuların dinamik olarak listelendiği sekme
local function createPlayerTPButton(player)
    local btn = PlayerTeleportTab:NewButton(player.Name .. " [TP]", function()
        teleportToPlayer(player.Name)
    end)
    -- Oyuncu ayrıldığında butonu kaldırmak için
    player.AncestryChanged:Connect(function()
        if player.Parent == nil then
            if btn and btn.Parent then btn:Destroy() end
        end
    end)
end

-- Mevcut oyuncuları ekle
for _, player in ipairs(Players:GetPlayers()) do
    if player ~= Player then
        createPlayerTPButton(player)
    end
end

-- Oyuncu eklenmelerini dinamik olarak takip et
Players.PlayerAdded:Connect(function(player)
    if player ~= Player then
        -- Yeni oyuncu geldiğinde yeni butonu oluştur
        createPlayerTPButton(player)
    end
end)

-- COMBAT
CombatTab:NewToggle("Aimbot (Closest Part)", false, toggleAimbot)
CombatTab:NewToggle("Silent Aim (Bullet TP)", false, toggleSilentAim)
CombatTab:NewToggle("Trigger Bot (Auto Fire)", false, toggleTriggerBot)
CombatTab:NewToggle("Hitbox Expander", false, toggleHitboxExpander)
CombatTab:NewToggle("No Recoil", false, toggleNoRecoil)
CombatTab:NewToggle("Tracers (Line to Target)", false, toggleTracers)

-- FUN
FunTab:NewButton("Character Fling (Launch)", flingCharacter)
FunTab:NewButton("Break My Joints", breakMyJoints)
FunTab:NewButton("Break Nearest Player Joints", breakNearestPlayerJoints)
FunTab:NewButton("Delete My Tools", deleteTools)
FunTab:NewToggle("Chat Spammer", false, toggleChatSpam)
FunTab:NewToggle("Spam Jump (Loop)", false, toggleSpamJump)
FunTab:NewButton("Mass Teleport All to Me", massTeleport)
FunTab:NewButton("Loop Kill All Players (Passive)", loopKill)
FunTab:NewButton("Crash Server (Attempt)", crashServer)

-- WORLD CONFIGS
WorldConfigsTab:NewToggle("Full Bright (No Shadows)", false, toggleFullBright)
WorldConfigsTab:NewToggle("No Fog", false, toggleNoFog)
WorldConfigsTab:NewToggle("Cool Skybox", false, toggleCoolSkybox)
WorldConfigsTab:NewToggle("No Weather/Atmosphere", false, toggleNoWeather)
WorldConfigsTab:NewSlider("Time Speed Rate", "x1", true, "TS", {min = 0, max = 10, default = 1}, setTimeRate)
WorldConfigsTab:NewButton("Set Time to Day", setTimeDay)
WorldConfigsTab:NewButton("Set Time to Midday", setTimeMidday)
WorldConfigsTab:NewButton("Set Time to Night", setTimeNight)
WorldConfigsTab:NewButton("Set Time to Midnight", setTimeMidnight)
WorldConfigsTab:NewButton("Reset Time", resetTime)

-- SETTINGS
SettingsTab:NewButton("Rejoin Server", function() game:GetService("TeleportService"):Teleport(game.PlaceId) end)
SettingsTab:NewButton("Reset Character", function() Player:LoadCharacter() end)
SettingsTab:NewButton("Destroy UI", function() library:Destroy() end)

-- =========================================================================================================
-- AZRA.SYS EK ÖZELLİKLERİN ENTEGRASYONU (YENİ BUTONLAR/TOGGLELAR)
-- =========================================================================================================

-- Player Configs: Exploits Section'a Ekle
PlayerConfigs:NewToggle("Force Field (Efor Alanı)", false, toggleForceField)

-- Fun Tab: Mass Actions Section'a Ekle
FunTab:NewButton("Ragdoll All Players (Bayılt)", ragdollAll)

-- World Configs Tab: Lighting Section'a Ekle
WorldConfigsTab:NewToggle("Third Person Zoom Hack", false, toggleThirdPersonZoomHack)

-- Combat Tab: Aimbot Section'a Ekle
CombatTab:NewToggle("Aimbot FOV Circle (Görsel)", false, function(state) toggleAimbotFovCircle(state, 150) end)

-- =========================================================================================================
-- KOD SONU
-- =========================================================================================================